---
marp: true
theme: default
paginate: true
---

# CPU構造の理解に向けた研究
## 中間発表
### 久乗 建汰

---

## 研究背景

- CPUはコンピュータの中心的な演算装置
- 実際に回路を作ることで、**コンピュータ内で何が起こっているかを具体的に理解**
- 教科書「コンピュータシステムの実装と実践」を参考に学習中

---

## 研究目的

- Verilogを用いて **NANDゲートから簡単なCPUを作る体験**
- 設計の完成ではなく、**低レイヤーでの動作理解を深めることが目的**
- コンピュータシステムの動作原理を論理ゲートレベルで具象し、学習に活かす

---
## 使用教材・技術

- **書籍:** 「コンピュータシステムの実装と実践」  
- **ゲーム:** Turing Complete（回路設計・CPU構造理解の参考）  
- **言語:** Verilog  
- **主な学習内容:**  
  - 基本論理回路の設計  
  - SRラッチ / Dラッチ / フリップフロップ  
  - MUX、ALU、レジスタの構築  
- **コード管理:** GitHubでVerilogコードを管理

---

## 現在の進捗（完了済みタスク）

| ステップ | モジュール | 内容 | 状態 |
| --- | --- | --- | --- |
| 1 | 基本ゲート | NAND, AND, OR, XOR, XNOR, NOT, AND3, OR3, <br> const_high / const_low | ✅ 完了 |
| 2 | 加算器 | half_adder, full_adder, adder8（8ビット） | ✅ 完了 |
| 3 | MUX | mux2, mux4（2:1, 4:1セレクタ） | ✅ 完了 |
| 4 | 順序回路 | SR Latch → D Latch → D Flip-Flop<br>（同期リセット対応） | ✅ 完了 |
| 5 | レジスタ | reg8（8ビット、WE付き）<br>regfile8x8（8本×8ビット、2R1W、R0固定0） | ✅ 完了 |

---

## 現在の進捗（完了済みタスク・続き）

| ステップ | モジュール | 内容 | 状態 |
| --- | --- | --- | --- |
| 6 | PC | pc8（+1インクリメント、同期リセット） | ✅ 完了 |
| 7 | ALU | alu1（1ビット、1-hotデコード学習用）<br>alu8（8ビット、ADD/SUB/AND/OR/XOR/NOT）<br>zero/carryフラグ付き | ✅ 完了 |
| 8 | メモリ | rom8x8（8エントリ×8ビット命令ROM） | ✅ 完了 |
| 9 | 制御回路 | decoder（命令デコーダ、opcode/rd/rs抽出） | ✅ 完了 |
| 10 | CPUコア | cpu_simple（シングルサイクルCPU統合）<br>Fetch→Decode→RegRead→ALU→WriteBack | ✅ 完了 |

---

## 実装したCPUの特徴

### アーキテクチャ
- **8ビットCPU**（シングルサイクル実行）
- **8本のレジスタ**（R0〜R7、R0は常に0固定）
- **命令メモリ**: 8エントリROM

### 命令セット（ISA）
```
命令フォーマット: [7:5]=opcode [4:3]=rd [2:0]=rs
サポート命令: ADD, SUB, AND, OR, XOR, NOT
動作: rd ← rd op rs （例: R1 ← R1 + R0）
```

---

## データパスの構成

```
PC → ROM → Decoder → Register File
                  ↓
              ALU (演算)
                  ↓
         Register WriteBack
```

1. **Fetch**: PCでROMから命令取得
2. **Decode**: opcode/rd/rsに分解
3. **Execute**: ALU演算（rd op rs）
4. **WriteBack**: 結果をrdに書き戻し
5. **PC更新**: PC ← PC + 1

※ 全て1クロックで完結

---

## 学習成果

### 設計理解
- **ゲートレベル**: NANDから全回路を構築
- **同期リセット**: クロック同期での状態初期化
- **1-hotデコード**: opcodeをミンターム展開→ゲート選択
- **階層的MUX**: 多入力選択を2入力MUXツリーで実現

### 動作検証
- 各モジュールごとにテストベンチ作成・検証済み
- CPU統合テストで命令実行の確認完了
- 波形ファイル（VCD）で内部動作を可視化

---

## 現状の課題と今後の展開

### 現状の制約
- 分岐命令なし（PCは常に+1）
- 即値ロード未実装
- メモリアクセス（LOAD/STORE）なし
- 命令はROM固定（実行時変更不可）

### 今後の拡張候補
1. **分岐命令**: 条件付きPC更新（BEQ, BNE等）
2. **即値ロード**: LI命令でレジスタに定数設定
3. **RAM追加**: LOAD/STORE命令でメモリアクセス
4. **命令書き込み**: ROM→RAM化で動的プログラムロード
5. **パイプライン化**: 5段（IF/ID/EX/MEM/WB）

---

## まとめ

### 達成内容
- NANDゲートからシングルサイクルCPUまで段階的構築に成功
- 基本命令セット（6種類）を実行可能
- 全モジュールの動作検証完了

### 学習効果
- CPU内部の動作原理を論理ゲートレベルで理解
- デコード・データパス・制御フローの設計パターン習得
- 同期回路設計の基礎を体得

### 次の目標
- 分岐・即値命令を追加し、より実用的なプログラム実行
- メモリ階層の理解を深める（キャッシュ等）


